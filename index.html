<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Котик ловит рыбку</title>
  <meta name="build-version" content="2024-06-02T20:00:00Z">
  <script>
    (function () {
      const versionMeta = document.querySelector('meta[name="build-version"]');
      const buildTag = versionMeta ? versionMeta.content.trim() : 'dev';
      const cacheTag = `${buildTag}-${Date.now().toString()}`;

      const appendAsset = (tagName, attributes) => {
        const element = document.createElement(tagName);
        Object.entries(attributes).forEach(([key, value]) => {
          element.setAttribute(key, value);
        });
        document.head.appendChild(element);
        return element;
      };

      appendAsset('link', {
        rel: 'stylesheet',
        href: `styles.css?v=${cacheTag}`,
      });

      appendAsset('script', {
        src: `game.js?v=${cacheTag}`,
        type: 'module',
      });
    })();
  </script>
</head>
<body>
    <div class="game-container">
      <h1>Котик ловит рыбку</h1>
      <div class="top-bar" aria-label="Меню">
        <button id="open-menu" type="button" class="secondary">Меню</button>
      </div>
      <div
        id="main-menu-overlay"
        class="modal-overlay"
        role="dialog"
        aria-modal="true"
        aria-labelledby="main-menu-title"
      >
        <div class="modal-card main-menu-card">
          <h2 id="main-menu-title">Меню</h2>
          <div class="modal-actions menu-actions">
            <button id="menu-play" type="button">Играть</button>
            <button id="menu-results" type="button">Результаты</button>
            <button id="menu-appearance" type="button">Внешний вид</button>
            <button id="menu-settings" type="button">Настройки</button>
          </div>
        </div>
      </div>
      <div id="mode-overlay" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="mode-title">
        <div class="modal-card">
          <h2 id="mode-title">Выберите режим игры</h2>
          <div class="modal-actions">
            <button id="start-single" type="button">Соло — 10 секунд на рыбку</button>
            <button id="start-single-shared" type="button">Соло — общий таймер</button>
            <button id="start-survival" type="button">Выживание — нет общего таймера, но с каждой рыбкой появляется больше мин</button>
            <button id="start-multiplayer" type="button">Мультиплеер</button>
          </div>
        </div>
      </div>
      <div
        id="results-overlay"
        class="modal-overlay hidden"
        role="dialog"
        aria-modal="true"
        aria-labelledby="results-title"
      >
        <div class="modal-card results-card">
          <div class="modal-header">
            <h2 id="results-title">Результаты</h2>
            <button id="results-back" type="button" class="secondary">Назад</button>
          </div>
          <section class="results-summary" aria-live="polite">
            <p id="results-summary">Сыграйте раунд, чтобы увидеть ваши результаты.</p>
            <p class="results-score">Очки: <span id="results-score-value">0</span></p>
          </section>
          <section class="scoreboard" aria-labelledby="scoreboard-title">
            <h2 id="scoreboard-title">Таблица лидеров</h2>
            <ol id="leaderboard" class="scoreboard-list"></ol>
            <form id="submit-score" class="scoreboard-form">
              <label class="scoreboard-label" for="player-name">Ваше имя</label>
              <div class="scoreboard-controls">
                <input
                  id="player-name"
                  name="player-name"
                  type="text"
                  maxlength="32"
                  autocomplete="name"
                  placeholder="Котолюбитель"
                  required
                >
                <button id="save-score" type="submit">Сохранить очки</button>
              </div>
            </form>
            <p id="score-status" class="scoreboard-status" role="status" aria-live="polite"></p>
          </section>
        </div>
      </div>
      <div
        id="settings-overlay"
        class="modal-overlay hidden"
        role="dialog"
        aria-modal="true"
        aria-labelledby="settings-title"
      >
        <div class="modal-card settings-card">
          <div class="modal-header">
            <h2 id="settings-title">Настройки</h2>
            <button id="settings-back" type="button" class="secondary">Назад</button>
          </div>
          <div class="settings-list">
            <label class="toggle-option" for="setting-sound">
              <div class="toggle-main">
                <span class="toggle-title">Звук</span>
                <span class="toggle-note">Вкл/выкл звуки игры</span>
              </div>
              <input id="setting-sound" type="checkbox" checked>
            </label>
            <label class="toggle-option" for="setting-music">
              <div class="toggle-main">
                <span class="toggle-title">Музыка</span>
                <span class="toggle-note">Вкл/выкл музыку на фоне</span>
              </div>
              <input id="setting-music" type="checkbox" checked>
            </label>
          </div>
        </div>
      </div>
      <div
        id="appearance-overlay"
        class="modal-overlay hidden"
        role="dialog"
        aria-modal="true"
        aria-labelledby="appearance-title"
      >
        <div class="modal-card settings-card">
          <div class="modal-header">
            <h2 id="appearance-title">Внешний вид котика</h2>
            <button id="appearance-back" type="button" class="secondary">Назад</button>
          </div>
          <p class="settings-section-note">Настройте цвета и аксессуары, чтобы ваш котик был уникальным.</p>
          <div class="appearance-layout">
            <div class="appearance-preview-card">
              <div class="appearance-preview-header">
                <span class="appearance-label">Предпросмотр</span>
              </div>
              <canvas id="cat-preview" width="240" height="180" aria-label="Предпросмотр котика"></canvas>
            </div>
            <div class="appearance-controls">
              <div class="appearance-grid">
                <label class="appearance-field" for="cat-color-base">
                  <span class="appearance-label">Цвет шерсти</span>
                  <input id="cat-color-base" type="color" value="#ffb347">
                </label>
                <label class="appearance-field" for="cat-color-belly">
                  <span class="appearance-label">Цвет животика</span>
                  <input id="cat-color-belly" type="color" value="#ffd59c">
                </label>
                <label class="appearance-field" for="cat-color-eyes">
                  <span class="appearance-label">Цвет глаз</span>
                  <input id="cat-color-eyes" type="color" value="#14365d">
                </label>
                <label class="appearance-field" for="cat-color-accessory">
                  <span class="appearance-label">Цвет аксессуаров</span>
                  <input id="cat-color-accessory" type="color" value="#3c78d8">
                </label>
                <label class="appearance-field" for="cat-hat">
                  <span class="appearance-label">Шапочка</span>
                  <select id="cat-hat">
                    <option value="none">Без шапочки</option>
                    <option value="beanie">Тёплая шапка</option>
                    <option value="cap">Кепка</option>
                    <option value="crown">Корона</option>
                    <option value="santa">Шапка Санты</option>
                    <option value="antlers">Оленьи рога и нос</option>
                  </select>
                </label>
                <label class="appearance-field" for="cat-boots">
                  <span class="appearance-label">Ботиночки</span>
                  <select id="cat-boots">
                    <option value="none">Без ботиночек</option>
                    <option value="sneakers">Кроссовки</option>
                    <option value="boots">Тёплые ботинки</option>
                  </select>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    <div id="multiplayer-overlay" class="modal-overlay hidden" role="dialog" aria-modal="true">
      <div class="modal-card" id="multiplayer-prejoin">
        <h2>Мультиплеер</h2>
        <div class="multiplayer-browser">
          <div class="multiplayer-room-list-header">
            <h3>Доступные комнаты</h3>
            <button id="multiplayer-room-refresh" type="button" class="secondary">Обновить</button>
          </div>
          <ul id="multiplayer-room-list" class="multiplayer-room-list" aria-live="polite"></ul>
          <p id="multiplayer-room-empty" class="multiplayer-room-empty">Пока нет открытых комнат. Создайте свою!</p>
          <p class="multiplayer-room-note">Подключаться можно только к комнатам, где раунд ещё не начался.</p>
        </div>
        <form id="multiplayer-join-form" class="multiplayer-form">
          <fieldset class="multiplayer-fieldset">
            <legend>Создать комнату</legend>
            <label class="scoreboard-label" for="multiplayer-name">Ваше имя</label>
            <input id="multiplayer-name" name="multiplayer-name" type="text" maxlength="32" autocomplete="name" placeholder="Котолюбитель" required>
            <label class="scoreboard-label" for="multiplayer-room">Название комнаты</label>
            <input id="multiplayer-room" name="multiplayer-room" type="text" maxlength="32" placeholder="Например, kotiki" required>
            <label class="scoreboard-label" for="multiplayer-mode">Режим</label>
            <select id="multiplayer-mode" name="multiplayer-mode">
              <option value="classic">Охота за рыбкой</option>
              <option value="bomb-pass">Бомба-пас</option>
              <option value="hide-and-seek">Прятки</option>
              <option value="shooters">Стрелялки</option>
            </select>
            <div class="modal-actions">
              <button type="submit">Создать</button>
              <button id="multiplayer-cancel" type="button">Назад</button>
            </div>
            <p id="multiplayer-error" class="multiplayer-error" role="alert"></p>
          </fieldset>
        </form>
      </div>
      <div id="multiplayer-lobby-shell" class="multiplayer-lobby-shell hidden">
        <div class="modal-card" id="multiplayer-lobby" role="document">
          <h2>Комната: <span id="multiplayer-room-label"></span></h2>
          <p id="multiplayer-status" class="multiplayer-status" role="status"></p>
          <ul id="multiplayer-player-list" class="multiplayer-player-list"></ul>
          <div class="modal-actions">
            <button id="multiplayer-ready" type="button">Готов</button>
            <button id="multiplayer-leave" type="button">Выйти</button>
          </div>
        </div>
        <div id="multiplayer-chat" class="modal-card multiplayer-chat hidden" aria-live="polite">
          <div class="multiplayer-chat-header">
            <h3>Чат комнаты</h3>
            <span id="multiplayer-chat-room" class="multiplayer-chat-room"></span>
          </div>
          <ul id="multiplayer-chat-messages" class="multiplayer-chat-messages"></ul>
          <form id="multiplayer-chat-form" class="multiplayer-chat-form">
            <label class="visually-hidden" for="multiplayer-chat-input">Сообщение</label>
            <input
              id="multiplayer-chat-input"
              name="multiplayer-chat-input"
              type="text"
              maxlength="240"
              placeholder="Написать сообщение"
              autocomplete="off"
            >
            <button type="submit">Отправить</button>
          </form>
        </div>
      </div>
    </div>
    <div id="multiplayer-hud" class="multiplayer-hud hidden" aria-live="polite">
      <div class="multiplayer-hud-header">
        <div>Комната: <span id="multiplayer-hud-room"></span></div>
        <div>Режим: <span id="multiplayer-hud-mode"></span></div>
        <div id="multiplayer-countdown" class="multiplayer-countdown"></div>
      </div>
      <ul id="multiplayer-hud-players" class="multiplayer-hud-players"></ul>
      <div id="multiplayer-game-message" class="multiplayer-game-message"></div>
    </div>
    <div class="hud">
      <div>Очки: <span id="score">0</span></div>
      <div>Время: <span id="timer">10.0</span> c</div>
      <div class="status-effect" aria-live="polite">
        <span class="status-effect-label">Эффект:</span>
        <span
          id="status-effect-icon"
          class="status-effect-icon"
          role="img"
          aria-label="Нет эффектов"
        >—</span>
      </div>
    </div>
    <div class="playfield">
      <canvas id="game" width="500" height="500" aria-label="Игровое поле"></canvas>
      <div class="controls" role="group" aria-label="Экранный джойстик для сенсорных устройств">
        <div class="joystick" aria-hidden="true">
          <div class="joystick-base">
            <div class="joystick-thumb" aria-hidden="true"></div>
          </div>
        </div>
        <div class="joystick-hint" aria-hidden="true">Перетащи кружок, чтобы управлять котиком</div>
      </div>
    </div>
    <div id="message" role="status"></div>
    <button id="restart" type="button">Играть снова</button>
  </div>
</body>
</html>
